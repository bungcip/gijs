{"version":3,"file":null,"sources":["../src/string.ts","../src/url.ts","../src/modal.ts","../src/ajax.ts","../src/main.ts"],"sourcesContent":["import * as ko from \"knockout\";\n\n/**\n * String Replacer\n * Helper function to create simple template string\n * Example:\n * \n * gi.replace(\"hello {name}\", {\n *   name: 'jane'\n * })\n * \n */\nexport function replace(str: string, dict: Object): string {\n    for (var key in dict) {\n        str = str.replace(\"{\" + key + \"}\", ko.unwrap(dict[key]));\n    }\n\n    return str;\n}\n","/// URL management\n\nimport {replace} from './string';\n\nexport let urlConfig = {\n    baseUrl: \"\"\n};\n\nexport function url(value: string, data?: Object): string {\n    let result = urlConfig.baseUrl + value;\n    if(data === null){\n        return result;\n    }\n    let param = data as Object;\n    return replace(result, param);\n}\n\n","import * as ko from 'knockout';\nimport * as $ from \"jquery\";\nimport { replace } from './string';\n\nvar MODAL_ROOT_NAME = \"bs-modal-root-{id}\";\n\n\nfunction _createDOMFromString(input: string) : Node {\n    var node = document.createElement('div');\n    node.innerHTML = input;\n\n    return node.firstChild;\n}\n\n/// common modal template\nfunction _createBsModal() : Node {\n    var template = _createDOMFromString(`<div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\n            <div class=\"modal-dialog\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-header\">\n                        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n                        <h4 class=\"modal-title\"></h4>\n                    </div>\n                    <div class=\"modal-body\"></div>\n                    <div class=\"modal-footer\">\n                        <!-- ko foreach: $buttons -->\n                            <button type=\"button\" class=\"btn\" data-bind=\"click: $parent.ok, html: $data.html, css: $data.className\">Ok</button>\n                        <!-- /ko -->\n                        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Batal</button>\n                    </div>\n                </div><!-- /modal-content -->\n            </div><!-- /modal-dialog -->\n        </div><!-- /modal -->\n    `);\n    return template;\n}\n\n\n\n\n/// alert modal template\nfunction _createAlertModal() : Element {\n    var template = _createDOMFromString(`<div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\n            <div class=\"modal-dialog\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-header\">\n                        <h4 class=\"modal-title\"></h4>\n                    </div>\n                    <div class=\"modal-body\"></div>\n                    <div class=\"modal-footer\" data-bind=\"with: $button\">\n                        <button type=\"button\" class=\"btn\" data-bind=\"click: $root.ok, html: html, css: className\">Ok</button>\n                    </div>\n                </div><!-- /modal-content -->\n            </div><!-- /modal-dialog -->\n        </div><!-- /modal -->\n    `);\n    return template as Element;\n}\n\ntype ExtractedDataFromTemplate = {className: string, title: string, body: string};\n/**\n * Ambil nilai title, body\n */\nfunction extractFromTemplate(templateId: string) : ExtractedDataFromTemplate {\n    var templateName = '#' + templateId;\n    var template = document.querySelector(templateId);\n\n    if(template === null || template.hasAttribute('content') === false){\n        throw `cannot extract template from ${templateName}`;\n    }\n\n    var clone = document.importNode(template['content'], true) as Element;\n\n\n    /// ambil tag <modal-title> untuk judul\n    let titleTag = clone.querySelector(\"modal-title\");\n    var title = \"\";\n    if(titleTag !== null){\n        title = titleTag.innerHTML;\n    }\n\n    /// ambil tag <modal-body> untuk content\n    let bodyTag = clone.querySelector(\"modal-body\");\n    if(bodyTag === null){\n        throw `template ${templateName} don't have <modal-body> element`;\n    }\n    var body = bodyTag.innerHTML;\n\n    /// ambil className\n    var className = template.className;\n\n    return {className, title, body};\n}\n\n/**\n * Inject data binding default untuk alert/modal\n */\nfunction applyBindings($root: Element, model: Object, resolve: Function, $button: [Object]|Object){\n    var bsModal = $root.querySelector('.modal');\n    model['ok'] = function (d) {\n        resolve(d.value);\n\n        /// NOTE: rollup.js is stupid...\n        let m = eval(\"$(bsModal)\") as JQuery;\n        m.modal('hide');\n    };\n    model['$button'] = $button;\n\n    ko.applyBindings(model, $root);\n}\n\n\n/// ambil div root untuk menaruh elemen bootstrap modal\nfunction _getModalRoot(counter) : Element {\n    counter = counter || 0;\n    var id = MODAL_ROOT_NAME.replace(\"{id}\", counter);\n    var dom = document.getElementById(id);\n    /// insert <div> ke dalam <body> bila belum ada\n    if (dom === null) {\n        dom = document.createElement('div');\n        dom.setAttribute('id', id);\n        document.body.appendChild(dom);\n    } else if (dom.hasChildNodes()) {\n        console.log(\"sudah terisi id \", id, dom.getElementsByTagName('div').length);\n        return _getModalRoot(counter + 1);\n    }\n    return dom;\n}\n\nfunction alert(config, model, counter?: number) : Promise<boolean | string> {\n    let promise = new Promise(function (resolve, reject) {\n        /// persiapkan DOM untuk modal dialog\n        let $root = _getModalRoot(counter);\n        /// set modal minimal objek kosong\n        model = model || {};\n\n        let {className, title, body} = extractFromTemplate(config);\n\n        let element = _createAlertModal();\n\n        element.querySelector(\".modal-title\").innerHTML = title;\n        element.querySelector('.modal-body').innerHTML = body;\n        element.querySelector('.modal-dialog').className = className;\n\n        /// persiapkan button\n        let $button = { className: \"btn-primary\", value: true, html: \"Ok\" };\n\n        $root.appendChild(element);\n\n        applyBindings($root, model, resolve, $button);\n\n        /// jalankan afterRender\n        if (model.afterRender) {\n            model.afterRender($root);\n        }\n\n        var bsModal = $root.querySelector('.modal');\n\n        /// NOTE: rollup.js is stupid...\n        var m = eval(\"$(bsModal)\") as JQuery;\n        m.modal('show');\n\n        /// hapus modal saat dihidden\n        m.on(\"hidden.bs.modal\", function () {\n            ko.cleanNode($root[0]);\n            ko.removeNode($root[0]);\n            m.remove();\n        });\n    });\n    return promise;\n}\n\n/// fungsi untuk menampilkan modal bootstrap\n/// ke layar secara dinamis mengembalikan objek Promise\nfunction modal(config, model, counter) : Promise<boolean | string> {\n    return new Promise(function(resolve, reject){\n        resolve(true);\n    });\n\n    // var promise = new Promise(function (resolve, reject) {\n    //     /// persiapkan DOM untuk modal dialog\n    //     var $root = _getModalRoot(counter);\n    //     var element = _createBsModal();\n    //     /// set modal minimal objek kosong\n    //     model = model || {};\n    //     /// reset binding yang ada di DOM sebelum menghapus data\n    //     //        ko.cleanNode($root[0]);\n    //     /// insert template\n    //     /// sekarang berasumsi config === string\n    //     var template = document.querySelector('#' + config);\n    //     var clone = document.importNode(template['content'], true);\n    //     /// ambil tag <modal-title> untuk judul\n    //     var title = $(clone).find('modal-title').html();\n\n\n    //     /// persiapkan button\n    //     var $buttons = [];\n    //     var okElements = $(clone).find('modal-ok');\n    //     okElements.each(function (i, okElement) {\n    //         var btnConfig = { className: \"btn-primary\" };\n    //         /// ambil kelas bila diperlukan\n    //         if (okElement.hasAttribute('class')) {\n    //             var okClass = okElement.attributes['class'].value;\n    //             btnConfig.className = okClass;\n    //         }\n\n    //         /// ambil tag <modal-ok> untuk tulisan button OK\n    //         var okLabel = okElement.innerHTML;\n    //         btnConfig['html'] = okLabel;\n\n    //         /// value\n    //         var value = true;\n    //         if (okElement.hasAttribute('value')) {\n    //             value = okElement.attributes['value'].value;\n    //         }\n    //         btnConfig['value'] = value;\n\n    //         $buttons.push(btnConfig);\n    //     });\n\n    //     /// tambahkan button default bila tidak ada\n    //     if ($buttons.length === 0) {\n    //         $buttons.push({ className: \"btn-primary\", value: true, html: \"Ok\" });\n    //     }\n\n\n    //     /// ambil tag <modal-body> untuk content\n    //     var body = $(clone).find('modal-body').html();\n    //     element.find('.modal-title').html(title);\n    //     element.find('.modal-body').html(body);\n    //     /// set class untuk modal-dialog bila ada\n    //     element.find('.modal-dialog').addClass(template.className);\n    //     $root.html(element);\n    //     var bsModal = $root.find('.modal');\n    //     model.ok = function (d) {\n    //         resolve(d.value);\n    //         bsModal.modal('hide');\n    //     };\n    //     model.$buttons = $buttons;\n\n    //     ko.applyBindings(model, $root[0]);\n\n    //     /// jalankan afterRender\n    //     if (model.afterRender) {\n    //         model.afterRender($root);\n    //     }\n\n    //     bsModal.modal('show');\n    //     /// hapus modal saat dihidden\n    //     bsModal.on(\"hidden.bs.modal\", function () {\n    //         ko.cleanNode($root[0]);\n    //         ko.removeNode($root[0]);\n    //         bsModal.remove();\n    //     });\n    // });\n    // return promise;\n};\n\n\n\n/// export\nexport { alert, modal };","import {ajax} from 'jquery';\r\n\r\n/// Default function to run when request fail.\r\n/// Override this function to change behavior\r\n/// default action is show error dialog\r\nexport function onRequestFail(response: any) {\r\n    console.log(\"Error:\", response);\r\n}\r\n\r\n/// helper function to send http request.\r\n/// automaticly register function app.onRequestFail to run\r\n/// when request return other than response code 200.\r\nexport function sendJSONRequest(type, url, data) {\r\n    return ajax({\r\n        url: url,\r\n        type: type,\r\n        data: data !== undefined ? JSON.stringify(data) : null,\r\n        contentType: \"application/json\"\r\n    }).fail(onRequestFail);\r\n}\r\n\r\n/// various helper function for sendJSONRequest\r\nexport const getJSON = (url, data) => sendJSONRequest('GET', url, data);\r\nexport const postJSON = (url, data) => sendJSONRequest('POST', url, data);\r\nexport const deleteJSON = (url, data) => sendJSONRequest('DELETE', url, data);\r\nexport const putJSON = (url, data) => sendJSONRequest('PUT', url, data);\r\n","'use strict';\r\n\r\nexport {replace} from './string';\r\nexport {url} from './url';\r\nexport * from './modal';\r\nexport * from './ajax';\r\n\r\nimport {urlConfig} from './url';\r\n\r\n\r\nexport function setup(data: {baseUrl: string}){\r\n    urlConfig.baseUrl = data.baseUrl;\r\n}"],"names":["ko.unwrap","ko.applyBindings","applyBindings","ko.cleanNode","ko.removeNode","ajax"],"mappings":"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"}